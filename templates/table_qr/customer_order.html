{% extends 'home/base.html' %}

{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
{% endblock head %}

{% block content %}
{% include 'include/alert.html' %}

{% load hotel_tag %}

<style>
    body{
        position: relative;
    }
    /* .img{
    position: absolute;
    z-index: -2;
    width: 100%;
    height: 100vh;
    background: url('https://qul.imgix.net/150ee868-a39f-434d-b2d9-ccb750f515b6/438489_sld.jpg') no-repeat center center;
    filter: blur(5px);
    top:0;

    }
    .img2{
    position: absolute;
    z-index: -3;
    width: 100%;
    height: 100vh;
    background: url('https://qul.imgix.net/150ee868-a39f-434d-b2d9-ccb750f515b6/438489_sld.jpg') no-repeat center center;
    filter: blur(5px);
    bottom:0;

    } */
    .detail_box{
        background-color: rgb(255, 255, 255);
        width: fit-content;
        margin: auto;
        padding: 10px;
        border-radius: 10px;
        box-shadow: inset -2px 2px 10px #000;

    }
</style>

{% load static %}
<link rel="stylesheet" href="{% static 'css/tost.css' %}">

<div class="img">

</div>
<div class="img2">

</div>
<div class="text-center detail_box">
    <b>{{hotel.hotel_name}}</b><br>
    <b>{{table.name}}</b>
</div>

<div class="text-center mt-2">
    <p>बिलिंग व बारकोड सॉफ्टवेअरसाठी मो.9730991252 <a href="tel:9730991252" class="btn btn-outline-success">संपर्क साधा</a></p>
</div>

<style>
    table{
        margin: auto;
    }
</style>
<table class="table">
    <thead>
        <tr>
          <th scope="col">नाव</th>
          <th scope="col">नग</th>
          <th scope="col">किंमत</th>
          <th scope="col">ऐकून</th>
          <th scope="col">परिस्थिती</th>
        </tr>
      </thead>
    <tbody id="cart">
      {% for t in customer_cart %}
        <tr>
            <td>{{t.item.marathi_name}} {{t.note}}</td>
            <td>{{t.qty}}</td>
            <td>{{t.price}}</td>
            <td>{{t.total_amount}}</td>
            <td style="width: 100px;"><h6 class="text-bg-danger text-center">Pending</h6>
            </td>
            <td>
                <form action="" method="POST"><input type="hidden" name="cart_id" value="{{t.id}}"><button type="submit" class="btn btn-danger btn-sm" name="delete_order">X</button></form>
            </td>
        </tr>
        {% endfor %}
        <hr>
      {% for t in hotel_cart %}
      <tr>
         
        <td>{{t.item.marathi_name}} {{t.note}}</td>
        <td>{{t.qty}}</td>
        <td>{{t.price}}</td>
        <td>{{t.total_amount}}</td>
        <td>{% if t.cook_status == 'Pendding' %}<h6 class="text-bg-info text-center">Waiter Acccepted</h6>{% else %}<h6 text-success class="text-bg-success text-center ">{{t.cook_status}}</h6>{% endif %}</td>
      </tr>
        {% endfor %}
    </tbody>
</table>
<b >Total Amount Rs.{{tp}}</b>

<style>
    .body{
        display: grid;
        grid-template-columns: 0.1fr 1fr;
    }
</style>
<div class="body">
    <div class="flex" style="justify-content: start;flex-direction: column;">
        {% for c in category %}
          <button class="btn btn-primary" id="category_btn{{c.id}}" style="box-shadow: -2px 2px 10px #ffffff;" onclick="filterItems('{{ c.id }}')" >{{ c.name }}</button>
        {% endfor %}
    </div>
    <div>
        <style>
            .dish_main_box{
                padding: 10px;
                display: grid;
                grid-template-columns: repeat(auto-fit, 300px);
                gap: 10px;
                width: 80%;
                margin: auto;
                justify-content: center;
                align-items: center;
            }
            .dish_box{
                background-color: white;

                box-shadow:  -1px 1px 7px #000;
                padding: 10px;
                border-radius: 10px;
                text-align: center;
                width: 200px;
                overflow: hidden;
                height: fit-content;
                position: relative;


            }
            .name{
                font-weight: 700px;
            }
            .flex{
                display: flex;
                gap: 10px;
                justify-content: center;
            }
            .total_price{
                display: none;
            }
            .item_image_box{
                top: 0;
                left: 0;
                right: 0;
                width: 100%;
                overflow: hidden;
                height: 100px;
                text-align: center;
                position: absolute;
                img{
                    width: 100%;
                    height: 100px;
                    object-fit: cover;
                }
            }
            .note{
                text-align: center;
                width: 180px;
            }
            .no_image{
                width: 100px !important;
            }
            .minus_pluse_btns{
                font-size: 20px;
                font-weight: 800;
                width: 100%;
                padding-top: 0;
                outline: 0;
            }
            @media only screen and (max-width: 600px) {
                .dish_main_box{
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                }
            }
            </style>
        <div class="dish_main_box" id="item_ruselt">
            {% for i in item %}
            <input type="hidden" name="id" value="{{i.id}}">
            <input type="hidden" name="price" value="{{i.price}}">
            <div class="dish_box">
                {% get_item_image_and_youtube_url i.id as item_image_and_youtube_url %}
                {% if item_image_and_youtube_url.image %}
                <div class="item_image_box">
                    <img src="{{item_image_and_youtube_url.image.url}}" loading="eager" alt="">
                </div>
                {% else %}
                <div class="item_image_box">
                    <img src="{% static 'img/dish.jpg' %}" class="no_image" alt="Image Not Available">
                </div>
                {% endif %}

                <br><br><br><br>
                <div class="name"><b>{{i.marathi_name}}</b></div>
                {% if table_qr.watch_and_order_status == 1 %}
                <div>
                    <div><input class="note" type="text" name="" style="width: 180px;" placeholder="Note" id="note{{i.id}}"></div>
                  <div class="row my-1 text-center">
                    <div class="col-3"><button type="button" onclick="minus('{{i.id}}','{{i.price}}')" class="minus_pluse_btns text-danger" >-</button></div>
                    <div class="col-5"><input type="text" name="qty" style="width: 50px; text-align: center;" id="qty{{i.id}}" value="1" ></div>
                    <div class="col-3"><button type="button" onclick="plus('{{i.id}}','{{i.price}}')" class="minus_pluse_btns text-success" >+</button></div>
                </div>
                <div class="flex">
                    <div class="mt-2"  >Rs.<input style="border: none; width: 70px;" type="text" name="total_amount"  id="price{{i.id}}" value="{{i.price}}" readonly></div>
                </div>
                <div style="width: 100%;"><button type="button" class="btn btn-danger btn-sm mx-auto" style="width: 100%;" onclick="add_to_cart('{{i.id}}','{{i.price}}')">ऑर्डर करा</button></div>
            </div>
                {% else %}
                <div class="text-center">
                    <b>Rs.{{i.price}}</b>
                </div>
                {% endif %}
            </div>

            {% endfor %}
        </div>
    </div>

</div>

<div id="tostBox">
</div>
<script src="{% static 'js/toast.js' %}"></script>

<script>
    function add_to_cart(id,price){
        var qty = document.getElementById('qty'+id).value
        var note = document.getElementById('note'+id).value
        p=qty*price
        $.ajax({
            url: "{% url 'add_item_to_customer_cart' %}",
            method: "GET",
            data:{
                table_id:'{{table.id}}',
                item_id:id,
                price:price,
                qty:qty,
                total_amount:p,
                note:note
            },
            success: function(res){
                $("html, body").animate({ scrollTop: 0 }, "fast");
                show_tost('ऑर्डर वेटर कडे गेली', 'success')
                setTimeout(function(){
                    location.reload();
                }, 1000)
                
                
            }
        })
    }
    last_category_id = ''
    function  filterItems(category_id){
        if (last_category_id){
        document.getElementById('category_btn'+last_category_id).className = "btn btn-primary"
      }
      document.getElementById('category_btn'+category_id).className = "btn btn-warning"
      last_category_id = category_id
        $.ajax({
            url: "{% url 'filter_items_by_category_customer' %}",
            method: "GET",
            data: {
                category_id: category_id,
                table_qr_id:'{{table_qr.id}}'
            },
  success: function(res) {
    document.getElementById('item_ruselt').innerHTML = res.t;
  }
});
}
function plus(id,price){
  var qty = document.getElementById('qty'+id).value
  if(qty < 50){
    qty++;
  document.getElementById('qty'+id).value=qty;
  p=qty*price
  document.getElementById('price'+id).value=p;
    //speak code

  const msg = new SpeechSynthesisUtterance;
  msg.text=qty;

  msg.voice=speechSynthesis.getVoices()[1];
  speechSynthesis.speak(msg);


//ajax



  }
}

  // minus btn code

    function minus(id,price){
  var qty = document.getElementById('qty'+id).value
  if(qty > 1){
  qty--;
  document.getElementById('qty'+id).value=qty;
  p=qty*price
  document.getElementById('price'+id).value=p;

        //speak code

        const msg = new SpeechSynthesisUtterance;
  msg.text=qty;

  msg.voice=speechSynthesis.getVoices()[1];
  speechSynthesis.speak(msg);
  }
  if(qty == 0){
    document.getElementById('item_detail'+id).style.display = 'none'

  }
    }
</script>

<br><br>
<br><br>
<br><br>
<footer style="margin-top: auto;margin-bottom: 0px;" >
    <div class="container">
        <p>&copy; 2025 Tej Order. All Rights Reserved.  <b>Total Scanned {{count}}</b></p>
    </div>
</footer>
<script src="https://unpkg.com/scrollreveal"></script>
{% endblock content %}
